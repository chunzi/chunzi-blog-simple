Vmware 设置

用了大约半年，我的笔记本开始频繁出现各种异常。速度也越来越慢，实在不堪忍受，于是终于下定决心重灌。目前我的开发都是在 Windows XP 下面安装了 Vmware 的虚拟机，跑一个 FreeBSD 来做的。以前配置 Vmware 的时候也是痛苦万分，总也不得正果，这次又要重配，按理说按照原来的思路做下来应该不会有问题，可事实无情的嘲讽了我，一度让我怀疑是不是老了，很多次解决掉的疑难问题再次出现的时候，只记得曾经发生过并且成功解决过，可就是死活记不起来具体是如何做的。这让我的内心无比痛苦。但是问题出现，就必须解决，上帝保佑，这次我还是在经历了很多个小时后，终于重见天日。回过头来看看，多么简单阿。

虚拟机在我的笔记本上，需要能够连接到外网。我工作中有两种上网方式，公司里，有一个 IP 为 192.168.1.2 的 ADSL 路由器拨号上网，windows 被 DHCP 分配一个内网的 IP 192.168.1.x 。家里通过有线通的 Cable Moden ，windows 直接获取外部 IP 地址。所以我需要在两种环境下都能使 FreeBSD 能够访问外网。

FreeBSD 设定为一个固定的内部 IP 地址，192.168.1.10 网关 192.168.1.2 。在公司内部，使用 Bridge 方式，将虚拟机直接挂到公司的内部网段中。简单而完美。

回到家里，或者无线拨号上网，则改为 host-only 方式，选择 Vmnet1 网段，该网段设为 192.168.1.0 ，而在 windows 的网络连接中对应的 Vmnet1 设置一个固定的 IP 192.168.1.2 。也就是说，这个时候 192.168.1.0 网段在我的 windows 内部，windows 本身作为 1.2 连到这个虚拟网络，之所以选这个 1.2 ，是因为如此可以不用修改 FreeBSD 的网络配置。FreeBSD 依然通过 1.2 这个 Gateway 出去。同时我们不需要 Vmware 自己提供的 DHCP 功能，直接从 dhcp adaptor 中删除 vmnet1 网段即可。

本来事情就是这么简单的。我从 1.2 ping 到 1.10 通。从 1.10 ping 1.2 不通。这个问题困扰了我很久。最后把 windows 的防火墙关掉，就通了。现在 FreeBSD 虽然可以 ping 到 1.2 可却 ping 不到外网地址。第一反应是共享连接。于是将连接到外网的连接属性中设置共享，于是提示将会改为 192.168.0.1 的 IP 地址。我立马选择否，因为我不需要使用 0.x 网段。于是事情依然没有进展。在万般无奈下，我选择了是，然后 Vmnet1 的网络连接从原来我设定的 192.168.1.2 被强制改为 192.168.0.1 。这让我很不爽。再手动改回来。到此为止，天空变得蔚蓝蔚蓝。

我遗漏了这两步，想来该是以前配置的时候，稀里糊涂地先做了这两步，而后才做之前的那些配置。所以我明白了，并不是记性不好，实在是以前解决问题的时候囫囵吞枣，迷迷糊糊的走过来的，所以自然不能回想起来喝醉酒时走过的路。还好不是老年痴呆，万幸万幸。知其所以然比起知其然，更为重要，否则冤枉路要走不止一回。