电子邮件的投递路由

提供电子邮件服务很多年，总有客户打电话说，怎么前天发出来的信件，今天才收到，你们的系统怎么回事？我们的第一反应是，不要着急，电子邮件和传统邮件一样，需要几个邮政局的接力投递，延迟的原因可能发生在任何一个环节上。我们向来凭事实说话，这样，你把延迟信件的邮件头（邮件原文中第一个空行以上的部分）给我们看看，我们分析给你看，到底问题出在哪里。

邮件头中的 Received 头，说明了每个投递环节的接力数据。当然我们不排除伪造的可能性，但通常假设这些信息都正确。不同的邮件系统所记录的 Received 头的格式不尽相同，不过仍然都包括了若干主要的信息：时间，IP，邮件服务器域名，处理状态说明等。

以往，我们会据此和用户说明，用户也会很自然的接受，大多时候发现美国总公司的邮件发送服务器存在队列延迟问题。有时候，还会对这段文本截图，然后做些简单的圈圈点点和说明，在发送给客户看。

上面的做法，比较麻烦，也不直观。通常给客户的 IT 人员解释比较容易。所以大约两年之前，我就想做一个模块，在 webmail 内提供邮件的另一个视图：根据 Received 头画出邮件的投递路径，并根据 IP 圈画出内网和外网，同时标注各环节的时间点和间隔时段。如此一目了然，不需多辨。

想法是好的，不过总未实现。今天看到另一个类似的应用，在 Google Map 上画出邮件投递的地域流转情况。参见：<a href="http://www.butterfat.net/emailroutemap/getpoints.pl">http://www.butterfat.net/emailroutemap/getpoints.pl</a> 它通过 HostIP.info 提供的数据将 IP 地址转化为地理经纬度，然后在 map 上标注。想法不错，不过不知道是否实用。

anyway，总是个好的尝试。同时也希望我能有时间完成很多想法中的实现。呵呵。